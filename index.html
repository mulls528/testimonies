<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stories</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #e8e8e8;
            color: #333;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            padding: 120px 40px 40px 40px;
        }

        .audio-list {
            list-style: none;
        }

        .audio-item {
            padding: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            text-align: left;
            --scroll-opacity: 1;
            opacity: var(--scroll-opacity);
        }

        .audio-item:hover {
            opacity: calc(var(--scroll-opacity) * 0.6);
        }

        .audio-item.playing {
            opacity: calc(var(--scroll-opacity) * 0.6);
        }

        .track-info {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            width: 100%;
        }

        .track-name {
            font-size: 5.265rem;
            font-weight: 500;
            color: #333;
            line-height: 0.945;
            max-width: 66.66%;
        }


        .duration-display {
            font-size: 5.265rem;
            font-weight: 500;
            color: #333;
            white-space: nowrap;
            line-height: 0.945;
        }

        .audio-item.playing .duration-display {
            display: none;
        }


        .progress-container {
            width: 60%;
            height: 6px;
            background: #ccc;
            border-radius: 3px;
            margin-top: 30px;
            overflow: hidden;
            visibility: hidden;
        }

        .audio-item.playing .progress-container {
            visibility: visible;
        }

        .progress-bar {
            height: 100%;
            background: #888;
            width: 0%;
            border-radius: 3px;
            transition: width 0.1s linear;
        }

        .controls-row {
            display: flex;
            width: 60%;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            visibility: hidden;
        }

        .audio-item.playing .controls-row {
            visibility: visible;
        }

        .time-display {
            font-size: 1.2rem;
            font-weight: 700;
            color: #666;
        }

        .play-pause-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            position: relative;
        }

        .play-pause-btn .pause-icon {
            display: flex;
            gap: 4px;
        }

        .play-pause-btn .pause-icon span {
            display: block;
            width: 4.4px;
            height: 15.4px;
            background: #666;
        }

        .play-pause-btn .play-icon {
            display: none;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 7.7px 0 7.7px 13.2px;
            border-color: transparent transparent transparent #666;
        }

        .audio-item.paused .play-pause-btn .pause-icon {
            display: none;
        }

        .audio-item.paused .play-pause-btn .play-icon {
            display: block;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #e8e8e8;
        }

        ::-webkit-scrollbar-thumb {
            background: #bbb;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        /* Sticky header */
        .site-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 30px 40px 15px 40px;
            text-align: center;
        }

        .site-header .title {
            font-size: 1.725rem;
            font-weight: 600;
            color: #333;
            line-height: 1.3;
        }


        /* Landing screen */
        .landing-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #e8e8e8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeOut 3s ease-in forwards;
        }

        .landing-screen .title {
            font-size: 3rem;
            font-weight: 700;
            color: black;
            text-align: center;
            line-height: 1.3;
        }

        .landing-screen .subtitle {
            font-size: 1.5rem;
            font-weight: 700;
            color: black;
            text-align: center;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            60% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="landing-screen" id="landingScreen">
        <div class="title">God's Humor</div>
        <div class="subtitle">as told by friends of his</div>
    </div>

    <header class="site-header">
        <div class="title">God's Humor</div>
    </header>

    <div class="container">
        <ul class="audio-list" id="audioList"></ul>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        // Remove landing screen after animation
        const landing = document.getElementById('landingScreen');
        landing.addEventListener('animationend', () => {
            landing.remove();
        });

        const audioFiles = [
            "ANABELLE Loved Squirrels, Not the Basement.mp3",
            "ASHLEY on the Healing Work of Humor.mp3",
            "CARSON Looks Forward to the Table.mp3",
            "CHELA Making Joy Complete.mp3",
            "CONNOR Couldn't Find an Apartment.mp3",
            "DAKOTA Read the Red Words.mp3",
            "DOM Prayed For Ice Cream Money.mp3",
            "DOM Was Spit on by a Giraffe.mp3",
            "ELLA Reflects on Reverence.mp3",
            "ERIC Was an Actor.mp3",
            "FREDDY Told You So.mp3",
            "HOLLAND Is Obsessed By the Way.mp3",
            "JAMES on Daddy Longlegs.mp3",
            "JEDEA Climbed a Hill.mp3",
            "JOSH & the Dumpster Ladder.mp3",
            "KEITHEN Consults Willard.mp3",
            "LILLY's Mom Hears Nails Drop.mp3",
            "OLIVIA on Suffering and Joy.mp3",
            "PAOLO Didn't Write This Down.mp3",
            "PERLA Asked God.mp3",
            "RILEY Thinks It's Ironic.mp3",
            "RILEY Would Also Freak Out In the Boat.mp3",
            "ROUKAYA Can't Do Screaming.mp3",
            "SAM Didn't Follow Instructions.mp3",
            "SARYA Cracks Up Over the Big Fish.mp3",
            "SAVANNA Still Laughs.mp3",
            "SEAN Points to the Platypus.mp3",
            "SERENA Winks Back.mp3",
            "TINA Says 'huh' .mp3",
            "YOHAAN Would Have Been Okay With a Boring Life .mp3"
        ];

        const audioList = document.getElementById('audioList');
        const audioPlayer = document.getElementById('audioPlayer');
        let currentlyPlaying = null;
        const audioDurations = {};

        // Format display name
        function formatDisplayName(filename) {
            const name = filename.replace('.mp3', '').trim();
            // Convert to lowercase, then capitalize first letter
            let result = name.toLowerCase();
            result = result.charAt(0).toUpperCase() + result.slice(1);
            // Capitalize proper nouns
            result = result.replace(/\bwillard\b/g, 'Willard');
            result = result.replace(/\bgod\b/g, 'God');
            // Prevent orphaned single word on last line (except "Keithen consults Willard")
            if (result !== 'Keithen consults Willard' && result !== 'Anabelle loved squirrels, not the basement') {
                const words = result.split(' ');
                if (words.length >= 3) {
                    return words.slice(0, -2).join(' ') + ' ' + words.slice(-2).join('\u00A0');
                }
            }
            return result;
        }

        // Format time as mm:ss
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Preload durations for all audio files
        function preloadDuration(file, element) {
            const audio = new Audio(encodeURIComponent(file));
            audio.addEventListener('loadedmetadata', () => {
                audioDurations[file] = audio.duration;
                element.querySelector('.duration-display').textContent = formatTime(audio.duration);
            });
        }

        // Create list items
        audioFiles.forEach((file, index) => {
            const li = document.createElement('li');
            li.className = 'audio-item';
            li.dataset.file = file;
            li.dataset.index = index;

            li.innerHTML = `
                <div class="track-info">
                    <span class="track-name">${formatDisplayName(file)}</span>
                    <span class="duration-display">--:--</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar"></div>
                </div>
                <div class="controls-row">
                    <button class="play-pause-btn" aria-label="Play/Pause">
                        <div class="pause-icon"><span></span><span></span></div>
                        <div class="play-icon"></div>
                    </button>
                    <div class="time-display">
                        <span class="current-time">0:00</span> / <span class="total-time">0:00</span>
                    </div>
                </div>
            `;

            li.addEventListener('click', (e) => {
                if (!e.target.closest('.progress-container') && !e.target.closest('.play-pause-btn')) {
                    togglePlay(li, file);
                }
            });

            li.querySelector('.play-pause-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                if (currentlyPlaying === li) {
                    if (audioPlayer.paused) {
                        audioPlayer.play();
                    } else {
                        audioPlayer.pause();
                    }
                }
            });

            audioList.appendChild(li);

            // Preload duration
            preloadDuration(file, li);
        });

        function togglePlay(element, file) {
            if (currentlyPlaying === element) {
                // Toggle pause/play on same track
                if (audioPlayer.paused) {
                    audioPlayer.play();
                } else {
                    audioPlayer.pause();
                }
            } else {
                // Stop current track if any
                if (currentlyPlaying) {
                    currentlyPlaying.classList.remove('playing');
                    currentlyPlaying.querySelector('.progress-bar').style.width = '0%';
                }

                // Play new track
                audioPlayer.src = encodeURIComponent(file);
                audioPlayer.play();
                element.classList.add('playing');
                currentlyPlaying = element;
            }
        }

        // Update play/pause button state
        audioPlayer.addEventListener('play', () => {
            if (currentlyPlaying) currentlyPlaying.classList.remove('paused');
        });

        audioPlayer.addEventListener('pause', () => {
            if (currentlyPlaying) currentlyPlaying.classList.add('paused');
        });

        // Update progress bar
        audioPlayer.addEventListener('timeupdate', () => {
            if (currentlyPlaying) {
                const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                currentlyPlaying.querySelector('.progress-bar').style.width = progress + '%';
                currentlyPlaying.querySelector('.current-time').textContent = formatTime(audioPlayer.currentTime);
            }
        });

        // Update duration when loaded
        audioPlayer.addEventListener('loadedmetadata', () => {
            if (currentlyPlaying) {
                currentlyPlaying.querySelector('.total-time').textContent = formatTime(audioPlayer.duration);
            }
        });

        // Handle track end
        audioPlayer.addEventListener('ended', () => {
            if (currentlyPlaying) {
                currentlyPlaying.querySelector('.progress-bar').style.width = '0%';
            }
        });

        // Allow clicking on progress bar to seek
        document.addEventListener('click', (e) => {
            const progressContainer = e.target.closest('.progress-container');
            if (progressContainer && progressContainer.closest('.audio-item') === currentlyPlaying) {
                e.stopPropagation();
                const rect = progressContainer.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                audioPlayer.currentTime = percent * audioPlayer.duration;
            }
        });

        // Fade out audio items gradually as they scroll toward the top
        const siteHeader = document.querySelector('.site-header');

        function updateFadeOnScroll() {
            const headerBottom = siteHeader.getBoundingClientRect().bottom;
            const viewportHeight = window.innerHeight;
            const fadeStart = viewportHeight * 0.15;
            const items = document.querySelectorAll('.audio-item');

            items.forEach(item => {
                const itemTop = item.getBoundingClientRect().top;
                if (itemTop <= 0) {
                    item.style.setProperty('--scroll-opacity', '0.1');
                } else if (itemTop < fadeStart) {
                    const ratio = itemTop / fadeStart;
                    item.style.setProperty('--scroll-opacity', 0.1 + ratio * 0.9);
                } else {
                    item.style.setProperty('--scroll-opacity', '1');
                }
            });
        }

        window.addEventListener('scroll', updateFadeOnScroll);
        updateFadeOnScroll();

    </script>
</body>
</html>
